
## API Requests
Parsony exposes two interfaces for every service method:

#### JSON/RPC

The JSON/RPC expands the range of verbs and actions that can be described
via API. All requests are made to a single endpoint via HTTP POST, and the
requested method is part of the request body.

#### REST

A more standard RESTful approach, each method also has it's own
URL endpoint and requests are made using the corresponding HTTP method.


Example:

Consider a hypothetical method of a User service that logs a user into a system.

 * Service: USER
 * Method: login

The standard RESTful approach allows a user to make a POST request to `/user/auth`:

```
POST https://my.api/user/auth
Body:
{
    "username": "john.doe"
    "password": ""*******"
}
```

The JSON/RPC approach requires the user to make all requests to the same endpoint
Assuming the JSON/RPC endpoint is `/json-rpc`

```
POST https://my.api/json-rpc
Body:
{
    "method":"user.login"
    "args" : {
        "username": "john.doe"
        "password": ""*******"
    }
}
```


## JSON/RPC

Let's breakdown a typical request to a JSON/RPC endpoint:

```
-H "Content-Type:application/json"
-H "Api-Key : <API Key>"
-H "Session-Token : <Session Token>"

{
    "method":"service.method",
    "args": {
        "arg1":"param1",
        "arg2":"param1
    }
    "signed":"3598hhh3924908jweliur2098342="
}
```

### Headers
**-H API Key**

If an api key is required by the endpoint, provide your key in the header.
In addition, the request body most be signed. See **Signing** below.

**-H Session Token**

If endpoint requires a session token, pass in the header as well. Session 
tokens are generated by the auth service our via ```user.login(user,pass)```


### API Credentials
Upon initial startup, an API Key-Pair will be generated and outputted in the 
console startup message. Additionally, it will be saved in ```.parsony.json```
in your WebServices root directory. 

API credentials can be created and managed using methods of the auth module. See below.

```$xslt
  "init": {
    "key": "bb224fb48eb71479d533982a34d479bc1e9b8200.key",
    "secret": "9701bcccb27693b1268c7c6d3dcbf4666e5ea7e2.secret"
  }
```

### Signing
All Parsony requests to endpoints that require an API Key must also have a signed
payload. Parsony-Web handles this automatically. A signature can is generated by
first _stringifying_ the payload, then hashing it along with the secret using
sha256. The hash signature must be hex, or base 16, encoded.

Example in Node.js:

```js
const crypto = require('crypto');

function sign(payload){
    const src = JSON.stringify(payload);
    const signature = _hash(src);
    return Object.assign(
      {},
      payload,
      { signed:signature }
    );
}

function _hash(src){
    const hash = crypto.createHash('sha256');
    hash.update(src);
    hash.update(this.secret);
    return hash.digest('hex');
}
```

### Hints
Return endpoint-level API documentation by passing ```hint:true``` and omitting
the args object.
**Note:** must be running with ```api_debug: true```.

Request:

```$xslt
-H "Content-Type:application/json"
-H "Api-Key : <API Key>"
-H "Session-Token : <Session Token>"

{
    "method":"service.method",
    "hint": true
}

```

Returns:

```$xslt
{
    "success": true,
    "error": null,
    "data": {
        "api_expects": {
            "method": "post",
            "service": "user",
            "json_api": "user.login",
            "RESTUrl": "/user/login",
            "desc": "Authenticates user and creates a new session.",
            "authentication": {
                "api_key": true,
                "session_token": false
            },
            "params": [
                {
                    "param": "username",
                    "required": true,
                    "validation": {
                        "is_type": "string",
                        "valid_email": true
                    }
                },
                {
                    "param": "password",
                    "required": true,
                    "validation": {
                        "is_type": "string",
                        "min_length": "6"
                    }
                }
            ],
            "returns": {
                "userId":1234
            },
            "errors": [
                "authentication_failed"
            ]
        }
    }
}
```